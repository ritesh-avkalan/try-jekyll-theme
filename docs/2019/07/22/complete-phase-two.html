<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name = "keywords" content = "fenics, topology optimization, isogeomtric analysis, hpc, phd blog, paraview, latex, computational mechanics, phd tools, parallel computation, python, phase field fracture, phase field topology optimization" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="FEniCS: Completion of phase two" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The second phase of google summer of code is complete." />
<meta property="og:description" content="The second phase of google summer of code is complete." />
<link rel="canonical" href="/2019/07/22/complete-phase-two.html" />
<meta property="og:url" content="/2019/07/22/complete-phase-two.html" />
<meta property="og:site_name" content="Abhinav Gupta" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-22T00:00:00+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="FEniCS: Completion of phase two" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-07-22T00:00:00+05:30","datePublished":"2019-07-22T00:00:00+05:30","description":"The second phase of google summer of code is complete.","headline":"FEniCS: Completion of phase two","mainEntityOfPage":{"@type":"WebPage","@id":"/2019/07/22/complete-phase-two.html"},"url":"/2019/07/22/complete-phase-two.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/main.css" type="text/css" media="all" />




  <link rel="shortcut icon" type="image/x-icon" href="/?" />
    <title> 
     
      FEniCS: Completion of phase two | 
    
    Abhinav Gupta
  </title>


  <!-- MailerLite Universal -->
  <script>
      (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
      .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
      n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
      (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
      ml('account', '325878');
  </script>
  <!-- End MailerLite Universal --><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Abhinav Gupta" /></head><body class="full_width_container"><div class="navbar-container">
    <div class="primary_container ">
        <a class="link home-icon" href="">
                <svg width="76px" height="100%" viewBox="0 0 63 40" >
                    <path d="M29.585,14.07l0.085,1.138l8.46,19.638l0.896,0.906c0.279,0.125 0.564,0.243 0.854,0.355c2.201,0.852 4.618,1.284 7.253,1.284c5.057,0 9.628,-1.101 13.717,-3.286l0.925,-1.544l0,-15.928l-1.75,-1.75l-11.924,0l-1.75,1.75l0,5.016l1.75,1.75l4.63,0c0,0 0,4.518 0,4.518c-0.594,0.254 -1.239,0.453 -1.934,0.6c-1.134,0.24 -2.34,0.358 -3.62,0.358c-1.348,0 -2.57,-0.236 -3.66,-0.726c-1.083,-0.487 -2.014,-1.154 -2.792,-2.005c-0.789,-0.862 -1.394,-1.888 -1.826,-3.07c-0.446,-1.225 -0.664,-2.566 -0.664,-4.021c0,-1.332 0.216,-2.577 0.656,-3.734c0.431,-1.132 1.037,-2.125 1.825,-2.974c0.777,-0.837 1.706,-1.49 2.786,-1.963c1.095,-0.48 2.321,-0.711 3.675,-0.711c1.37,0 2.671,0.226 3.901,0.683c1.182,0.438 2.192,1.054 3.02,1.859l2.463,-0.025l4.092,-4.136l-0.078,-2.536c-1.849,-1.651 -3.946,-2.797 -6.29,-3.44c-2.228,-0.612 -4.611,-0.921 -7.152,-0.921c-2.635,0 -5.052,0.432 -7.253,1.284c-2.243,0.867 -4.172,2.106 -5.792,3.71c-1.617,1.601 -2.887,3.534 -3.802,5.804c-0.275,0.683 -0.509,1.388 -0.701,2.117Z" style="fill-rule:nonzero;"/><path d="M16.141,3.21l-1.604,1.052l-13.552,31.152l1.604,2.448l6.204,0l1.628,-1.107l2.379,-6.021c-0,0 11.141,0 11.141,0c-0,0 2.46,6.038 2.46,6.038l1.62,1.09l6.336,0l1.608,-2.442l-13.42,-31.152l-1.608,-1.058l-4.796,0Zm4.507,19.272l-4.597,0c0,0 2.32,-6.017 2.32,-6.017l2.277,6.017Z" style="fill-rule:nonzero;"/>
                </svg>
        </a>
        <div class="navbar align_menu" style="font-family: Montserrat; font-weight:500">
            <a class="link" href="/pages/blog">Articles</a>
            <a class="link" href="/pages/projects">Projects</a>
            <a class="link nav_desktop" href="/pages/newsletters">Newsletter</a>
            <a class="link" href="/pages/about">About</a>
            <a href="/2019/07/22/complete-phase-two.html" id="theme-toggle" onclick="modeSwitcher()" style="cursor: pointer;">Dark</a>
        </div>
    </div>
</div><main aria-label="Content">
        <div>
            <div class="post_container">
    <div class="post_item_left" style=" padding-bottom:50px; ">
        <div class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

            <head>
                <title>FEniCS: Completion of phase two</title>
                <script type="text/x-mathjax-config">
                    MathJax.Hub.Config({
                    extensions: ["tex2jax.js"],
                    jax: ["input/TeX", "output/HTML-CSS"],
                    tex2jax: {
                      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                      processEscapes: true
                    },
                    "HTML-CSS": { availableFonts: ["TeX"] }
                  });
                </script>
                <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
            </head>
            <header class="post-header" style="margin-bottom: 60px;">
                <h1 style="font-weight:600; font-size: 46px; margin-top: 120px; " class="post-title p-name" itemprop="name headline">
                    FEniCS: Completion of phase two
                </h1>
                <p class="post-meta" style="font-size: 16px;">
                    <time class="dt-published" datetime="2019-07-22T00:00:00+05:30" itemprop="datePublished">Jul 22, 2019
                    </time><span style="padding-left:10px;padding-right: 10px;">|</span><span class="post-meta"><a style="font-size:14px;color: var(--text-color);" href="/categories/coding">CODING</a></span><!-- --------------------------------------- -->
                </p>
            </header>
            <hr style="/*position: relative; width: 300%;right:calc(200% - 30px);*/ background: var(--color-1);border: none;height: 1px; margin-bottom: 80px; opacity: 1;">
            <div class="post-content e-content enlarged-char" itemprop="articleBody">
                <p>Goals for the second phase of the programming were two-fold:</p>

<ul>
  <li>Create a method to construct MVC from arrays</li>
  <li>Develope code to test the integration of gmsh API with new mesh workflow.</li>
</ul>

<p>Creating MVC directly from arrays would allow bypassing saving of the mesh file onto the hard disk. The idea is to directly create MVC from pygmsh data. The functionality was achieved with and <a href="https://github.com/FEniCS/dolfinx/pull/467">the following PR was made</a>. Here is a snippet to create MVC from pygmsh data.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;cfloat&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;dolfin.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"main.h"</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">dolfin</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

    <span class="k">auto</span> <span class="n">dummy_mesh</span> <span class="o">=</span> <span class="n">DummyMesh</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">vect</span> <span class="o">=</span> <span class="n">dummy_mesh</span><span class="p">.</span><span class="n">points</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">co_ord_point_map</span><span class="p">;</span>


    <span class="n">dolfin</span><span class="o">::</span><span class="n">io</span><span class="o">::</span><span class="n">XDMFFile</span> <span class="n">xdmf_file</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="s">"../input/mesh_2d.xdmf"</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">mesh_2d</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">mesh</span><span class="o">::</span><span class="n">Mesh</span><span class="o">&gt;</span><span class="p">(</span><span class="n">xdmf_file</span><span class="p">.</span><span class="n">read_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="o">::</span><span class="n">GhostMode</span><span class="o">::</span><span class="n">none</span><span class="p">));</span>

    <span class="k">auto</span> <span class="n">mvc</span> <span class="o">=</span> <span class="n">dolfin</span><span class="o">::</span><span class="n">mesh</span><span class="o">::</span><span class="n">MeshValueCollection</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mesh_2d</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                                          <span class="n">dummy_mesh</span><span class="p">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">dummy_mesh</span><span class="p">.</span><span class="n">cell_data</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You can find the complete code <a href="https://github.com/iitrabhi/GSoC2019/tree/master/Scripts/cpp/mesh-workflow-no-xdmf">here</a>.</p>

<h2 id="python--pygmsh">Python + Pygmsh</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pygmsh.built_in.geometry</span> <span class="kn">import</span> <span class="n">Geometry</span>
<span class="kn">from</span> <span class="n">pygmsh</span> <span class="kn">import</span> <span class="n">generate_mesh</span>
<span class="kn">import</span> <span class="n">dolfin</span>
<span class="kn">import</span> <span class="n">dolfin.io</span>

<span class="n">geom</span> <span class="o">=</span> <span class="nc">Geometry</span><span class="p">()</span>

<span class="n">mesh_ele_size</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_point</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lcar</span><span class="o">=</span><span class="n">mesh_ele_size</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_point</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lcar</span><span class="o">=</span><span class="n">mesh_ele_size</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_point</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lcar</span><span class="o">=</span><span class="n">mesh_ele_size</span><span class="p">)</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_point</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lcar</span><span class="o">=</span><span class="n">mesh_ele_size</span><span class="p">)</span>

<span class="n">l0</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
<span class="n">l1</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
<span class="n">l2</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
<span class="n">l3</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_line</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>

<span class="n">ll</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_line_loop</span><span class="p">(</span><span class="n">lines</span><span class="o">=</span><span class="p">[</span><span class="n">l0</span><span class="p">,</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span><span class="p">])</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">geom</span><span class="p">.</span><span class="nf">add_plane_surface</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>

<span class="c1"># Tag line and surface
</span><span class="n">geom</span><span class="p">.</span><span class="nf">add_physical</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">BOTTOM</span><span class="sh">"</span><span class="p">)</span>
<span class="n">geom</span><span class="p">.</span><span class="nf">add_physical</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">RIGHT</span><span class="sh">"</span><span class="p">)</span>
<span class="n">geom</span><span class="p">.</span><span class="nf">add_physical</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">TOP</span><span class="sh">"</span><span class="p">)</span>
<span class="n">geom</span><span class="p">.</span><span class="nf">add_physical</span><span class="p">(</span><span class="n">l3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">LEFT</span><span class="sh">"</span><span class="p">)</span>
<span class="n">geom</span><span class="p">.</span><span class="nf">add_physical</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">"</span><span class="s">DOMAIN</span><span class="sh">"</span><span class="p">)</span>


<span class="n">mesh</span> <span class="o">=</span> <span class="nf">generate_mesh</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
<span class="n">points</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">cell_data</span><span class="p">,</span> <span class="n">boundary</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">.</span><span class="n">points</span><span class="p">,</span> <span class="n">mesh</span><span class="p">.</span><span class="n">cells</span><span class="p">,</span> <span class="n">mesh</span><span class="p">.</span><span class="n">cell_data</span><span class="p">,</span> <span class="n">mesh</span><span class="p">.</span><span class="n">field_data</span>

<span class="n">comm</span> <span class="o">=</span> <span class="n">dolfin</span><span class="p">.</span><span class="n">MPI</span><span class="p">.</span><span class="n">comm_world</span>
<span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="p">.</span><span class="nc">Get_rank</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">My rank is </span><span class="sh">'</span><span class="p">,</span> <span class="n">rank</span><span class="p">)</span>

<span class="n">mesh_from_array</span> <span class="o">=</span> <span class="n">dolfin</span><span class="p">.</span><span class="n">cpp</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span>
    <span class="n">dolfin</span><span class="p">.</span><span class="n">MPI</span><span class="p">.</span><span class="n">comm_world</span><span class="p">,</span>
    <span class="n">dolfin</span><span class="p">.</span><span class="n">cpp</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">CellType</span><span class="p">.</span><span class="n">triangle</span><span class="p">,</span>
    <span class="n">points</span><span class="p">,</span>
    <span class="n">cells</span><span class="p">[</span><span class="sh">'</span><span class="s">triangle</span><span class="sh">'</span><span class="p">],</span>
    <span class="p">[],</span>
    <span class="n">dolfin</span><span class="p">.</span><span class="n">cpp</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">GhostMode</span><span class="p">.</span><span class="n">none</span><span class="p">)</span>


<span class="n">mvc_from_array</span> <span class="o">=</span> <span class="n">dolfin</span><span class="p">.</span><span class="nc">MeshValueCollection</span><span class="p">(</span><span class="sh">"</span><span class="s">size_t</span><span class="sh">"</span><span class="p">,</span>
                                            <span class="n">mesh_from_array</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span>
                                            <span class="n">cells</span><span class="p">[</span><span class="sh">"</span><span class="s">line</span><span class="sh">"</span><span class="p">],</span>
                                            <span class="n">cell_data</span><span class="p">[</span><span class="sh">"</span><span class="s">line</span><span class="sh">"</span><span class="p">][</span><span class="sh">'</span><span class="s">gmsh:physical</span><span class="sh">'</span><span class="p">])</span>
</code></pre></div></div>

<h2 id="python--gmsh-api">Python + Gmsh API</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">gmsh</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">numpy</span>
<span class="kn">import</span> <span class="n">meshio</span>

<span class="kn">from</span> <span class="n">dolfin</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MPI</span><span class="p">,</span> <span class="n">MeshValueCollection</span><span class="p">,</span> <span class="n">cpp</span><span class="p">)</span>

<span class="c1"># Map from gmsh to type that is also used by meshio
</span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="sh">'</span><span class="s">line</span><span class="sh">'</span><span class="p">,</span>
           <span class="mi">2</span><span class="p">:</span> <span class="sh">'</span><span class="s">triangle</span><span class="sh">'</span><span class="p">,</span>
           <span class="mi">4</span><span class="p">:</span> <span class="sh">'</span><span class="s">tetra</span><span class="sh">'</span><span class="p">,</span>
           <span class="mi">8</span><span class="p">:</span> <span class="sh">'</span><span class="s">line3</span><span class="sh">'</span><span class="p">,</span>
           <span class="mi">9</span><span class="p">:</span> <span class="sh">'</span><span class="s">triangle6</span><span class="sh">'</span><span class="p">,</span>
           <span class="mi">11</span><span class="p">:</span> <span class="sh">'</span><span class="s">tetra10</span><span class="sh">'</span><span class="p">,</span>
           <span class="mi">15</span><span class="p">:</span> <span class="sh">'</span><span class="s">vertex</span><span class="sh">'</span>
           <span class="p">}</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">line</span><span class="sh">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">triangle</span><span class="sh">'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">tetra</span><span class="sh">'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">line3</span><span class="sh">'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">triangle6</span><span class="sh">'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">tetra10</span><span class="sh">'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
         <span class="sh">'</span><span class="s">vertex</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span>
         <span class="p">}</span>

<span class="c1"># Generate mesh
</span><span class="n">mesh_ele_size</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">gmsh</span><span class="p">.</span><span class="nf">initialize</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sh">'</span><span class="s">unit_square</span><span class="sh">'</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addPoint</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mesh_ele_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addPoint</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mesh_ele_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addPoint</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mesh_ele_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addPoint</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mesh_ele_size</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addLine</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addLine</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addLine</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addLine</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addCurveLoop</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">addPlaneSurface</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">addPhysicalGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">setPhysicalName</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">BOTTOM</span><span class="sh">"</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">addPhysicalGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">setPhysicalName</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="sh">"</span><span class="s">TOP</span><span class="sh">"</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">addPhysicalGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">setPhysicalName</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="sh">"</span><span class="s">LEFT</span><span class="sh">"</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">addPhysicalGroup</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">setPhysicalName</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="sh">"</span><span class="s">RIGHT</span><span class="sh">"</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">addPhysicalGroup</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">setPhysicalName</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="sh">"</span><span class="s">DOMAIN</span><span class="sh">"</span><span class="p">)</span>

<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">geo</span><span class="p">.</span><span class="nf">synchronize</span><span class="p">()</span>
<span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="nf">generate</span><span class="p">()</span>
<span class="n">nodeTags</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">parametricCoord</span> <span class="o">=</span> <span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="nf">getNodes</span><span class="p">()</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Reshape to get right format
</span><span class="n">points</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="n">coord</span><span class="p">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">dim</span><span class="p">),</span> <span class="n">dim</span><span class="p">))</span>
<span class="n">element_types</span><span class="p">,</span> <span class="n">element_tags</span><span class="p">,</span> <span class="n">node_tags</span> <span class="o">=</span> <span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="nf">getElements</span><span class="p">()</span>
<span class="n">cells</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">cell_data</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Generate cells and cell_data dict
</span><span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">element_types</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>
    <span class="n">num_nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="c1"># since nodes are numbered starting from 0
</span>    <span class="n">cells</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_tags</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">cells</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">name</span><span class="p">],</span>
                                <span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="nf">int</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">name</span><span class="p">].</span><span class="n">size</span> <span class="o">/</span> <span class="n">num_nodes</span><span class="p">),</span>
                                    <span class="n">num_nodes</span><span class="p">))</span>
    <span class="c1"># If mesh contains the physical group of dimension dim
</span>    <span class="c1"># -1 to match with gmsh api dimensions
</span>    <span class="n">dim_tags</span> <span class="o">=</span> <span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nf">getPhysicalGroups</span><span class="p">(</span><span class="n">num_nodes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dim_tags</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dim_tag</span> <span class="ow">in</span> <span class="n">dim_tags</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">dim_tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">dim_tag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">element_type</span><span class="p">,</span> <span class="n">element_tag</span><span class="p">,</span> <span class="n">node_tag</span> <span class="o">=</span> <span class="n">gmsh</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="nf">getElements</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ele_num</span> <span class="ow">in</span> <span class="n">element_tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">element_tags</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">element_tags</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">ele_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="n">cell_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">element_tags</span><span class="p">[</span><span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">gmsh</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">unit_square.geo_unrolled</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># End Generate mesh
</span><span class="n">gmsh</span><span class="p">.</span><span class="nf">finalize</span><span class="p">()</span>

<span class="n">meshio</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sh">"</span><span class="s">unit_square_gmsh.xdmf</span><span class="sh">"</span><span class="p">,</span> <span class="n">meshio</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span>
    <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span>
    <span class="n">cells</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">triangle</span><span class="sh">"</span><span class="p">:</span> <span class="n">cells</span><span class="p">[</span><span class="sh">"</span><span class="s">triangle</span><span class="sh">"</span><span class="p">]}))</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">cpp</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="nc">Mesh</span><span class="p">(</span><span class="n">MPI</span><span class="p">.</span><span class="n">comm_world</span><span class="p">,</span>
                     <span class="n">cpp</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">CellType</span><span class="p">.</span><span class="n">triangle</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span>
                     <span class="n">cells</span><span class="p">[</span><span class="sh">'</span><span class="s">triangle</span><span class="sh">'</span><span class="p">],</span>
                     <span class="p">[],</span> <span class="n">cpp</span><span class="p">.</span><span class="n">mesh</span><span class="p">.</span><span class="n">GhostMode</span><span class="p">.</span><span class="n">none</span><span class="p">)</span>

<span class="n">mvc_from_array</span> <span class="o">=</span> <span class="nc">MeshValueCollection</span><span class="p">(</span><span class="sh">"</span><span class="s">size_t</span><span class="sh">"</span><span class="p">,</span>
                                     <span class="n">mesh</span><span class="p">,</span>
                                     <span class="mi">1</span><span class="p">,</span>
                                     <span class="n">cells</span><span class="p">[</span><span class="sh">"</span><span class="s">line</span><span class="sh">"</span><span class="p">],</span>
                                     <span class="n">cell_data</span><span class="p">[</span><span class="sh">"</span><span class="s">line</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div></div>


            </div>
            <div class="PageNavigation">
                
                <a class="button button-prev" href="/2019/07/01/xdmf-schema.html" title="FEniCS: The XDMF schema">&laquo; Previous</a>
                
                
                <a class="button button-next" href="/2019/08/24/gsoc-complete.html" title="GSoC complete: FEniCS-The mesh workflow">Next &raquo;</a>
                
            </div>
            <!-- ----------------------------------------------------------- -->
            <hr style="/*position: relative; width: 300%;right:calc(200% - 30px);*/ background: var(--color-1);border: none;height: 1px; margin-bottom: 80px; opacity: 1;">
            <div class="flexbox_container_two_col flexbox_container_flip " style="padding-top: 50px;padding-bottom: 50px;">
                <div class="flexbox_item">
                    <div>
                        <p style="font-size:36px; font-family: Montserrat; font-weight: bold; line-height: 1.2; ">Newsletter</p>
                        <p style="font-size:16px; padding-top: 20px; padding-bottom: 30px;">"<em><strong>Quality Research:</strong> A weekly newsletter covering ideas and tools for better academic research.</em>" </p>
                        <a class="ml-onclick-form button button-hello" href="javascript:void(0)" onclick="ml('show', 'uSsXyN', true)">Try the free newsletter</a>
                    </div>
                </div>
                <div class="flexbox_item">
                    <div class="abhi-icon" style="vertical-align: middle;     float: right;"><object data="/assets/svg/newsletter.svg" width="80%" style="pointer-events: none;"> </object></div>
                </div>
            </div>
            <!-- ----------------------------------------------------------- -->
        </div>
    </div>
    <div class="post_item_right hide_mobile">
        <p style="padding-top:200px; font-size: 14px; font-family: Montserrat;">ABOUT THE AUTHOR</p>
        <hr style="/*position: relative; width: 300%;right:calc(200% - 30px);*/ background: var(--color-1);border: none;height: 1px; margin-bottom: 40px;">
        <p style="margin-bottom:20px;font-size: 14px;">Hi, I am <strong>Abhinav Gupta</strong>. I am a researcher at Vanderbilt University, USA. I create content to help you become effective in producing quality research. If you are interested in research, academia, or computational mechanics, make sure to follow me. </p>
        <div style="margin-top:50px;">
            <ul class="social-media-list" style="font-size: 14px;">
                <li>
                    <a class="black-link" href="https://www.linkedin.com/in/abhiguptaio/" target="_blank" rel="noopener noreferrer">[LinkedIn]</a>
                </li>
                <li>
                    <a class="black-link" href="https://github.com/iitrabhi" target="_blank" rel="noopener noreferrer"> [Github]</a>
                </li>
                <li>
                    <a class="black-link" href="https://www.researchgate.net/profile/Abhinav_Gupta52" target="_blank" rel="noopener noreferrer">[RG]</a>
                </li>
                <li>
                    <p>ðŸ‘‹</p>
                </li>
            </ul>
        </div>
        <a class="hover_highlight" style="font-size: 14px;" href="/pages/about">Click here to learn more â†’</a>
        <p style="margin-bottom:50px"></p>
    </div>
</div>
        </div>
    </main>
<div style="min-height: 500px;background-color: #000; width:100%">
    <div class="primary_container">
        <div style="flex: 60%; ">
            <p style="font-family:Montserrat; color:#fff; font-weight:700; margin-top: 50px;">ABHI GUPTA</p>
        </div>
        <div class="hide_mobile" style="flex: 20%;">
            <p style="font-family:Montserrat; color:#888; font-weight:700; margin-top: 50px;">Categories</p>
             <p><a href="/categories/coding"  style="color:#ddd; font-size: 16px;">Coding</a></p>
            <p><a href="/categories/presentation"  style="color:#ddd;font-size: 16px;">Presentation</a></p>
            <p><a href="/categories/productivity"  style="color:#ddd;font-size: 16px;">Productivity</a></p>
        </div>
        <div style="flex: 20%; ">
            <p style="font-family:Montserrat; color:#888; font-weight:700; margin-top: 50px;">Links</p>
           
            <p><a href="https://twitter.com/abhiguptaio"  style="color:#ddd;font-size: 16px;">Twitter</a></p>
            <p><a href="https://www.youtube.com/channel/UCpj8oznjjLwVe5KHOGNrvnQ" style="color:#ddd;font-size: 16px;">YouTube</a></p>

             <p><a href="https://github.com/iitrabhi" style="color:#ddd;font-size: 16px;">GitHub</a></p>
             <p><a href="https://www.linkedin.com/in/abhiguptaio/"  style="color:#ddd;font-size: 16px;">LinkedIn</a></p>

            <p><a href="https://scholar.google.com/citations?user=UfWvIkEAAAAJ"  style="color:#ddd;font-size: 16px;">Google Scholar</a></p>
            <p><a href="https://www.researchgate.net/profile/Abhinav-Gupta-38"  style="color:#ddd;font-size: 16px;">Research Gate</a></p>
            
        </div>
    </div>
</div>
<script src="/assets/js/mode_switcher.js" type="text/javascript"></script>
    <script src="/assets/js/code_block.js" type="text/javascript"></script>
</body>

</html>